<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2M Motos Gastronomia | Sistema de Pedidos</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00f3ff;
            --primary-dark: #0099cc;
            --secondary: #ff2a6d;
            --dark: #0c0f1d;
            --dark-light: #1a1f3a;
            --light: #f5f7ff;
            --success: #2dff9d;
            --warning: #ffb52d;
            --danger: #ff2d6d;
            --radius: 10px;
            --transition: all 0.3s ease;
            --shadow: 0 5px 15px rgba(0, 243, 255, 0.1);
            --shadow-hover: 0 10px 25px rgba(0, 243, 255, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Exo 2', sans-serif;
            background-color: var(--dark);
            color: var(--light);
            line-height: 1.6;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 243, 255, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 42, 109, 0.05) 0%, transparent 20%);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 30px;
            border-bottom: 1px solid rgba(0, 243, 255, 0.2);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-img {
            height: 60px;
            width: auto;
        }

        .logo-text {
            font-family: 'Orbitron', sans-serif;
            font-weight: 900;
            font-size: 2rem;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: 1px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            font-weight: bold;
            border: 2px solid var(--primary);
            box-shadow: var(--shadow);
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
        }

        .user-level {
            font-size: 0.8rem;
            color: var(--primary);
            font-weight: 600;
        }

        .logout-btn {
            background: transparent;
            border: 1px solid var(--secondary);
            color: var(--light);
            padding: 8px 15px;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Exo 2', sans-serif;
        }

        .logout-btn:hover {
            background: var(--secondary);
            box-shadow: 0 0 15px rgba(255, 42, 109, 0.5);
        }

        .main-content {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 30px;
        }

        .sidebar {
            background-color: var(--dark-light);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 243, 255, 0.1);
        }

        .nav-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 243, 255, 0.2);
        }

        .nav-list {
            list-style: none;
            margin-bottom: 30px;
        }

        .nav-item {
            margin-bottom: 10px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            border-radius: var(--radius);
            color: var(--light);
            text-decoration: none;
            transition: var(--transition);
        }

        .nav-link:hover, .nav-link.active {
            background-color: rgba(0, 243, 255, 0.1);
            color: var(--primary);
            box-shadow: var(--shadow);
        }

        .nav-icon {
            font-size: 1.2rem;
        }

        .content-area {
            background-color: var(--dark-light);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 243, 255, 0.1);
            min-height: 600px;
        }

        .section-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section-title::after {
            content: '';
            flex-grow: 1;
            height: 2px;
            background: linear-gradient(to right, var(--primary), transparent);
        }

        .hidden {
            display: none !important;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--primary);
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 243, 255, 0.3);
            border-radius: var(--radius);
            color: var(--light);
            font-family: 'Exo 2', sans-serif;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.3);
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%2300f3ff' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 16px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: var(--radius);
            font-family: 'Exo 2', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            color: var(--dark);
        }

        .btn-primary:hover {
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.5);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: linear-gradient(45deg, var(--secondary), #d4004e);
            color: var(--light);
        }

        .btn-secondary:hover {
            box-shadow: 0 0 20px rgba(255, 42, 109, 0.5);
            transform: translateY(-2px);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.9rem;
        }

        .btn-filter {
            padding: 8px 15px;
            background-color: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Exo 2', sans-serif;
        }

        .btn-filter:hover {
            background-color: rgba(0, 243, 255, 0.1);
        }

        .btn-filter.active {
            background-color: var(--primary);
            color: var(--dark);
        }

        /* Cards */
        .card {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: var(--radius);
            padding: 20px;
            border: 1px solid rgba(0, 243, 255, 0.1);
            transition: var(--transition);
        }

        .card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }

        .card-title {
            font-size: 1.3rem;
            color: var(--primary);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .card-subtitle {
            color: var(--secondary);
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .card-text {
            color: #aaa;
            margin-bottom: 15px;
            font-size: 0.95rem;
        }

        /* Items Grid */
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .item-card {
            position: relative;
            overflow: hidden;
        }

        .item-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .item-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .item-select-btn {
            background-color: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 8px 15px;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Exo 2', sans-serif;
        }

        .item-select-btn:hover {
            background-color: var(--primary);
            color: var(--dark);
        }

        .item-selected {
            background-color: var(--primary);
            color: var(--dark);
        }

        /* Order Summary */
        .order-summary {
            margin-top: 30px;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: var(--radius);
            border: 1px solid rgba(0, 243, 255, 0.2);
        }

        .summary-title {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .selected-items-list {
            list-style: none;
            margin-bottom: 20px;
        }

        .selected-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .remove-item {
            color: var(--danger);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .order-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
            padding-top: 15px;
            border-top: 1px solid rgba(0, 243, 255, 0.3);
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            background-color: rgba(0, 243, 255, 0.1);
            color: var(--primary);
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .data-table tr:hover {
            background-color: rgba(0, 243, 255, 0.05);
        }

        .badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-admin {
            background-color: rgba(255, 42, 109, 0.2);
            color: var(--secondary);
        }

        .badge-operator {
            background-color: rgba(0, 243, 255, 0.2);
            color: var(--primary);
        }

        .badge-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-pending {
            background-color: rgba(255, 181, 45, 0.2);
            color: var(--warning);
        }

        .badge-ready {
            background-color: rgba(45, 255, 157, 0.2);
            color: var(--success);
        }

        .badge-cancelled {
            background-color: rgba(255, 45, 109, 0.2);
            color: var(--danger);
        }

        /* Tabs */
        .tabs {
            display: flex;
            margin-bottom: 25px;
            border-bottom: 1px solid rgba(0, 243, 255, 0.2);
        }

        .tab {
            padding: 12px 25px;
            background: none;
            border: none;
            color: var(--light);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            font-family: 'Exo 2', sans-serif;
            font-weight: 600;
        }

        .tab:hover {
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        /* Filters */
        .filters-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 25px;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: var(--radius);
            border: 1px solid rgba(0, 243, 255, 0.1);
        }

        .filter-title {
            font-weight: 600;
            color: var(--primary);
            margin-right: 10px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .filter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        /* Alert */
        .alert {
            padding: 15px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-success {
            background-color: rgba(45, 255, 157, 0.1);
            border: 1px solid var(--success);
            color: var(--success);
        }

        .alert-error {
            background-color: rgba(255, 45, 109, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
        }

        /* Login Screen */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-card {
            width: 100%;
            max-width: 450px;
            background-color: var(--dark-light);
            border-radius: var(--radius);
            padding: 40px;
            box-shadow: var(--shadow-hover);
            border: 1px solid rgba(0, 243, 255, 0.2);
            text-align: center;
        }

        .login-logo {
            font-size: 3.5rem;
            color: var(--primary);
            margin-bottom: 20px;
            text-shadow: 0 0 20px var(--primary);
        }

        .login-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            margin-bottom: 30px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        /* Footer */
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(0, 243, 255, 0.2);
            color: #aaa;
            font-size: 0.9rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal {
            background-color: var(--dark-light);
            border-radius: var(--radius);
            padding: 30px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(0, 243, 255, 0.2);
            box-shadow: var(--shadow-hover);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            color: var(--primary);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--light);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--secondary);
        }

        /* Order Actions */
        .order-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .order-status-filter {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .status-filter-btn {
            padding: 8px 15px;
            background-color: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .status-filter-btn:hover {
            background-color: rgba(0, 243, 255, 0.1);
        }

        .status-filter-btn.active {
            background-color: var(--primary);
            color: var(--dark);
        }

        /* Responsive */
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                margin-bottom: 20px;
            }
            
            .items-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .items-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                text-align: left;
            }
            
            .logo-text {
                font-size: 1.5rem;
            }
            
            .logo-img {
                height: 50px;
            }
            
            .filters-container {
                flex-direction: column;
            }
            
            .order-actions {
                flex-direction: column;
            }
        }
        
        /* Restaurant specific */
        .restaurant-badge {
            display: inline-block;
            padding: 3px 8px;
            background-color: rgba(0, 243, 255, 0.1);
            border-radius: 4px;
            font-size: 0.8rem;
            margin-bottom: 5px;
        }
        
        .restaurant-address {
            font-size: 0.8rem;
            color: #888;
            margin-top: 3px;
        }
        
        .no-items {
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px;
            color: #aaa;
        }
        
        /* Order Details */
        .order-details {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .order-user {
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .order-date {
            color: #aaa;
            font-size: 0.9rem;
        }
        
        /* Status indicators */
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-online {
            background-color: var(--success);
            box-shadow: 0 0 10px var(--success);
        }
        
        .status-offline {
            background-color: var(--warning);
            box-shadow: 0 0 10px var(--warning);
        }
        
        .sync-status {
            font-size: 0.8rem;
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .sync-btn {
            padding: 4px 8px;
            font-size: 0.7rem;
            background-color: rgba(0, 243, 255, 0.1);
            border: 1px solid var(--primary);
            color: var(--primary);
            border-radius: 4px;
            cursor: pointer;
        }
        
        .sync-btn:hover {
            background-color: rgba(0, 243, 255, 0.2);
        }
        
        /* Loading spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 243, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Badge for pending sync */
        .badge-sync {
            background-color: rgba(255, 181, 45, 0.2);
            color: var(--warning);
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
        }
        
        /* Log entry styles */
        .log-entry {
            padding: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            font-size: 0.85rem;
        }
        
        .log-entry-success {
            color: var(--success);
        }
        
        .log-entry-error {
            color: var(--danger);
        }
        
        .log-entry-warning {
            color: var(--warning);
        }
        
        .log-entry-info {
            color: var(--primary);
        }
        
        .log-timestamp {
            color: #888;
            font-size: 0.75rem;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-card">
            <img src="https://i.ibb.co/DD98rjsH/logo1.png" alt="2M Motos Logo" class="logo-img" style="height: 80px; margin: 0 auto 20px; display: block;">
            <h1 class="login-title">2M MOTOS GASTRONOMIA</h1>
            <p style="margin-bottom: 30px; color: #aaa;">Sistema futurista de pedidos culinários</p>
            
            <div class="form-group">
                <label for="loginUsername" class="form-label">Usuário</label>
                <input type="text" id="loginUsername" class="form-control" placeholder="Digite seu login">
            </div>
            
            <div class="form-group">
                <label for="loginPassword" class="form-label">Senha</label>
                <input type="password" id="loginPassword" class="form-control" placeholder="Digite sua senha">
            </div>
            
            <div class="form-group">
                <button id="loginButton" class="btn btn-primary" style="width: 100%; margin-top: 20px;">
                    <i class="fas fa-sign-in-alt"></i> Entrar no Sistema
                </button>
            </div>
            
            <div id="connectionStatus" style="margin-top: 20px; padding: 10px; background-color: rgba(0,0,0,0.3); border-radius: var(--radius);">
                <div id="statusText" style="color: #aaa; font-size: 0.9rem;">Verificando conexão...</div>
            </div>
            
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
                <p style="color: #aaa; font-size: 0.9rem;">
                    <strong>Sistema Digital Inteligente de Pedidos 2M Motos</strong>
                    <strong>Copyright 2026 - Todos os direitos reservados</strong>
                </p>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app" class="hidden">
        <div class="container">
            <header>
                <div class="logo">
                    <img src="https://i.ibb.co/DD98rjsH/logo1.png" alt="2M Motos Logo" class="logo-img">
                    <div class="logo-text">2M MOTOS GASTRONOMIA</div>
                </div>
                
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <div class="user-details">
                        <div class="user-name" id="userName">Administrador</div>
                        <div class="user-level" id="userLevel">Administrador</div>
                        <div class="sync-status" id="syncStatus">
                            <span class="status-indicator status-online" id="statusIndicator"></span>
                            <span id="syncText">Online</span>
                            <button class="sync-btn" onclick="forceSync()" id="syncButton">
                                <i class="fas fa-sync-alt"></i> Sincronizar
                            </button>
                        </div>
                    </div>
                    <button id="logoutButton" class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Sair
                    </button>
                </div>
            </header>
            
            <div class="main-content">
                <nav class="sidebar">
                    <h3 class="nav-title">NAVEGAÇÃO</h3>
                    <ul class="nav-list">
                        <li class="nav-item">
                            <a href="#" class="nav-link active" data-section="order">
                                <i class="fas fa-utensils nav-icon"></i> Montar Pedido
                            </a>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-section="my-orders">
                                <i class="fas fa-clipboard-list nav-icon"></i> Meus Pedidos
                            </a>
                        </li>
                        <li class="nav-item admin-only">
                            <a href="#" class="nav-link" data-section="all-orders">
                                <i class="fas fa-list-alt nav-icon"></i> Todos os Pedidos
                            </a>
                        </li>
                        <li class="nav-item admin-only">
                            <a href="#" class="nav-link" data-section="items">
                                <i class="fas fa-hamburger nav-icon"></i> Cadastrar Itens
                            </a>
                        </li>
                        <li class="nav-item admin-only">
                            <a href="#" class="nav-link" data-section="restaurants">
                                <i class="fas fa-store nav-icon"></i> Restaurantes
                            </a>
                        </li>
                        <li class="nav-item admin-only">
                            <a href="#" class="nav-link" data-section="users">
                                <i class="fas fa-users nav-icon"></i> Usuários
                            </a>
                        </li>
                        <li class="nav-item admin-only">
                            <a href="#" class="nav-link" data-section="sync">
                                <i class="fas fa-sync-alt nav-icon"></i> Sincronização
                            </a>
                        </li>
                    </ul>
                    
                    <h3 class="nav-title">PEDIDO ATUAL</h3>
                    <div class="order-summary">
                        <div class="summary-title">Resumo do Pedido</div>
                        <div class="order-user" id="currentOrderUser"></div>
                        <ul class="selected-items-list" id="selectedItemsList">
                            <li class="selected-item">
                                <span>Nenhum item selecionado</span>
                            </li>
                        </ul>
                        <div class="order-total">
                            <span>Total:</span>
                            <span id="orderTotal">R$ 0,00</span>
                        </div>
                        <button id="placeOrderButton" class="btn btn-secondary" style="width: 100%; margin-top: 15px;">
                            <i class="fas fa-paper-plane"></i> Finalizar Pedido
                        </button>
                    </div>
                </nav>
                
                <main class="content-area">
                    <!-- Montar Pedido -->
                    <div id="order-section" class="section">
                        <h2 class="section-title">
                            <i class="fas fa-utensils"></i> Montar seu Pedido
                        </h2>
                        
                        <!-- Filtros -->
                        <div class="filters-container">
                            <div style="display: flex; align-items: center; width: 100%; margin-bottom: 15px;">
                                <div class="filter-title">
                                    <i class="fas fa-filter"></i> Filtrar por:
                                </div>
                            </div>
                            
                            <div style="width: 100%; margin-bottom: 15px;">
                                <div class="filter-title">
                                    <i class="fas fa-utensils"></i> Tipo de Pedido
                                </div>
                                <div class="filter-options">
                                    <button class="tab active" data-type="almoco">Almoço</button>
                                    <button class="tab" data-type="lanche">Lanche</button>
                                    <button class="tab" data-type="outros">Outros</button>
                                </div>
                            </div>
                            
                            <div style="width: 100%;">
                                <div class="filter-title">
                                    <i class="fas fa-store"></i> Restaurante
                                </div>
                                <div class="filter-options" id="restaurantFilters">
                                    <!-- Filtros de restaurantes serão carregados aqui -->
                                </div>
                            </div>
                        </div>
                        
                        <div id="itemsContainer" class="items-grid">
                            <!-- Itens serão carregados aqui -->
                        </div>
                    </div>
                    
                    <!-- Meus Pedidos -->
                    <div id="my-orders-section" class="section hidden">
                        <h2 class="section-title">
                            <i class="fas fa-clipboard-list"></i> Meus Pedidos
                        </h2>
                        
                        <div class="order-status-filter">
                            <button class="status-filter-btn active" data-status="all">Todos</button>
                            <button class="status-filter-btn" data-status="pending">Pendentes</button>
                            <button class="status-filter-btn" data-status="ready">Prontos</button>
                            <button class="status-filter-btn" data-status="cancelled">Cancelados</button>
                        </div>
                        
                        <div id="myOrdersContainer">
                            <p>Você ainda não fez nenhum pedido.</p>
                        </div>
                    </div>
                    
                    <!-- Todos os Pedidos (Admin) -->
                    <div id="all-orders-section" class="section hidden">
                        <h2 class="section-title">
                            <i class="fas fa-list-alt"></i> Todos os Pedidos
                        </h2>
                        
                        <div class="order-status-filter">
                            <button class="status-filter-btn active" data-status="all">Todos</button>
                            <button class="status-filter-btn" data-status="pending">Pendentes</button>
                            <button class="status-filter-btn" data-status="ready">Prontos</button>
                            <button class="status-filter-btn" data-status="cancelled">Cancelados</button>
                        </div>
                        
                        <div id="allOrdersContainer">
                            <p>Nenhum pedido realizado no sistema.</p>
                        </div>
                    </div>
                    
                    <!-- Cadastrar Itens (Admin) -->
                    <div id="items-section" class="section hidden">
                        <h2 class="section-title">
                            <i class="fas fa-hamburger"></i> Cadastrar Itens
                        </h2>
                        
                        <div class="card" style="margin-bottom: 30px;">
                            <h3 class="card-title">Adicionar Novo Item</h3>
                            <form id="itemForm">
                                <div class="form-group">
                                    <label for="itemRestaurant" class="form-label">Restaurante</label>
                                    <select id="itemRestaurant" class="form-control form-select" required>
                                        <option value="">Selecione um restaurante</option>
                                        <!-- Restaurantes serão carregados dinamicamente -->
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="itemType" class="form-label">Tipo</label>
                                    <select id="itemType" class="form-control form-select" required>
                                        <option value="">Selecione um tipo</option>
                                        <option value="almoco">Almoço</option>
                                        <option value="lanche">Lanche</option>
                                        <option value="outros">Outros</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="itemName" class="form-label">Nome do Item</label>
                                    <input type="text" id="itemName" class="form-control" placeholder="Ex: Quantum Burger" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="itemDescription" class="form-label">Descrição</label>
                                    <textarea id="itemDescription" class="form-control" rows="3" placeholder="Descreva o item..." required></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label for="itemPrice" class="form-label">Preço (R$)</label>
                                    <input type="number" id="itemPrice" class="form-control" min="0" step="0.01" placeholder="0.00" required>
                                </div>
                                
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-plus-circle"></i> Adicionar Item
                                </button>
                            </form>
                        </div>
                        
                        <h3 class="section-title" style="font-size: 1.5rem;">Itens Cadastrados</h3>
                        <div class="items-grid" id="adminItemsContainer">
                            <!-- Itens cadastrados serão exibidos aqui -->
                        </div>
                    </div>
                    
                    <!-- Restaurantes (Admin) -->
                    <div id="restaurants-section" class="section hidden">
                        <h2 class="section-title">
                            <i class="fas fa-store"></i> Gerenciar Restaurantes
                        </h2>
                        
                        <div class="card" style="margin-bottom: 30px;">
                            <h3 class="card-title">Adicionar Novo Restaurante</h3>
                            <form id="restaurantForm">
                                <div class="form-group">
                                    <label for="restaurantName" class="form-label">Nome do Restaurante</label>
                                    <input type="text" id="restaurantName" class="form-control" placeholder="Ex: Quantum Steakhouse" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="restaurantAddress" class="form-label">Endereço</label>
                                    <input type="text" id="restaurantAddress" class="form-control" placeholder="Ex: Av. Tecnológica, 123 - Centro" required>
                                </div>
                                
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-plus-circle"></i> Cadastrar Restaurante
                                </button>
                            </form>
                        </div>
                        
                        <h3 class="section-title" style="font-size: 1.5rem;">Restaurantes Cadastrados</h3>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Endereço</th>
                                        <th>Itens Cadastrados</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="restaurantsTableBody">
                                    <!-- Restaurantes serão carregados aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Gerenciar Usuários (Admin) -->
                    <div id="users-section" class="section hidden">
                        <h2 class="section-title">
                            <i class="fas fa-users"></i> Gerenciar Usuários
                        </h2>
                        
                        <div class="card" style="margin-bottom: 30px;">
                            <h3 class="card-title">Adicionar Novo Usuário</h3>
                            <form id="userForm">
                                <div class="form-group">
                                    <label for="userNameInput" class="form-label">Nome Completo</label>
                                    <input type="text" id="userNameInput" class="form-control" placeholder="Ex: João Silva" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="userLogin" class="form-label">Login</label>
                                    <input type="text" id="userLogin" class="form-control" placeholder="Ex: joao.silva" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="userPassword" class="form-label">Senha</label>
                                    <input type="password" id="userPassword" class="form-control" placeholder="Digite uma senha" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="userLevel" class="form-label">Nível de Acesso</label>
                                    <select id="userLevelSelect" class="form-control form-select" required>
                                        <option value="">Selecione um nível</option>
                                        <option value="admin">Administrador</option>
                                        <option value="operator">Operador</option>
                                    </select>
                                </div>
                                
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-user-plus"></i> Cadastrar Usuário
                                </button>
                            </form>
                        </div>
                        
                        <h3 class="section-title" style="font-size: 1.5rem;">Usuários do Sistema</h3>
                        <div class="table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Login</th>
                                        <th>Nível</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <!-- Usuários serão carregados aqui -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Nova Seção: Sincronização -->
                    <div id="sync-section" class="section hidden">
                        <h2 class="section-title">
                            <i class="fas fa-sync-alt"></i> Sincronização
                        </h2>
                        
                        <div class="card" style="margin-bottom: 20px;">
                            <h3 class="card-title">Status da Conexão</h3>
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <div id="syncStatusIndicator" class="status-indicator status-online"></div>
                                <div>
                                    <div id="syncStatusText" style="font-weight: 600; color: var(--primary);">Conectado ao Baserow</div>
                                    <div id="syncLastUpdate" style="font-size: 0.9rem; color: #aaa;">Última sincronização: Nunca</div>
                                </div>
                            </div>
                            
                            <div class="sync-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
                                <div class="stat-card" style="background-color: rgba(0,0,0,0.2); padding: 15px; border-radius: var(--radius);">
                                    <div style="font-size: 2rem; color: var(--primary); text-align: center;" id="statUsers">0</div>
                                    <div style="text-align: center; color: #aaa;">Usuários</div>
                                </div>
                                <div class="stat-card" style="background-color: rgba(0,0,0,0.2); padding: 15px; border-radius: var(--radius);">
                                    <div style="font-size: 2rem; color: var(--primary); text-align: center;" id="statRestaurants">0</div>
                                    <div style="text-align: center; color: #aaa;">Restaurantes</div>
                                </div>
                                <div class="stat-card" style="background-color: rgba(0,0,0,0.2); padding: 15px; border-radius: var(--radius);">
                                    <div style="font-size: 2rem; color: var(--primary); text-align: center;" id="statItems">0</div>
                                    <div style="text-align: center; color: #aaa;">Itens</div>
                                </div>
                                <div class="stat-card" style="background-color: rgba(0,0,0,0.2); padding: 15px; border-radius: var(--radius);">
                                    <div style="font-size: 2rem; color: var(--primary); text-align: center;" id="statOrders">0</div>
                                    <div style="text-align: center; color: #aaa;">Pedidos</div>
                                </div>
                                <div class="stat-card" style="background-color: rgba(0,0,0,0.2); padding: 15px; border-radius: var(--radius);">
                                    <div style="font-size: 2rem; color: var(--primary); text-align: center;" id="statPending">0</div>
                                    <div style="text-align: center; color: #aaa;">Pendentes</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card" style="margin-bottom: 20px;">
                            <h3 class="card-title">Controle de Sincronização</h3>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px;">
                                <button class="btn btn-primary" onclick="syncAllData()">
                                    <i class="fas fa-sync-alt"></i> Sincronizar Tudo
                                </button>
                                <button class="btn" style="background-color: transparent; border: 1px solid var(--primary); color: var(--primary);" onclick="syncUsers()">
                                    <i class="fas fa-users"></i> Sinc. Usuários
                                </button>
                                <button class="btn" style="background-color: transparent; border: 1px solid var(--primary); color: var(--primary);" onclick="syncRestaurants()">
                                    <i class="fas fa-store"></i> Sinc. Restaurantes
                                </button>
                                <button class="btn" style="background-color: transparent; border: 1px solid var(--primary); color: var(--primary);" onclick="syncItems()">
                                    <i class="fas fa-hamburger"></i> Sinc. Itens
                                </button>
                                <button class="btn" style="background-color: transparent; border: 1px solid var(--primary); color: var(--primary);" onclick="syncOrders()">
                                    <i class="fas fa-clipboard-list"></i> Sinc. Pedidos
                                </button>
                                <button class="btn" style="background-color: transparent; border: 1px solid var(--success); color: var(--success);" onclick="syncPendingData()">
                                    <i class="fas fa-upload"></i> Enviar Pendentes
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <h3 class="card-title">Log de Sincronização</h3>
                            <div id="syncLog" style="max-height: 300px; overflow-y: auto; margin-top: 15px; padding: 10px; background-color: rgba(0,0,0,0.2); border-radius: var(--radius);">
                                <div style="color: #aaa; text-align: center; padding: 20px;">Nenhuma atividade de sincronização ainda.</div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 15px;">
                                <button class="btn btn-sm" style="background-color: transparent; border: 1px solid var(--danger); color: var(--danger);" onclick="clearSyncLog()">
                                    <i class="fas fa-trash"></i> Limpar Log
                                </button>
                                <button class="btn btn-sm" style="background-color: transparent; border: 1px solid var(--primary); color: var(--primary);" onclick="exportSyncLog()">
                                    <i class="fas fa-download"></i> Exportar Log
                                </button>
                                <button class="btn btn-sm" style="background-color: transparent; border: 1px solid var(--secondary); color: var(--secondary);" onclick="testBaserowConnection()">
                                    <i class="fas fa-plug"></i> Testar Conexão
                                </button>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
            
            <footer>
                <p>2M Motos Gastronomia &copy; 2023 - Sistema de Pedidos Futurista</p>
                <p>Tecnologia de ponta para experiências culinárias extraordinárias</p>
            </footer>
        </div>
    </div>

    <!-- Modal para Editar Pedido -->
    <div id="editOrderModal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Editar Pedido</h3>
                <button class="modal-close" onclick="closeEditOrderModal()">&times;</button>
            </div>
            <div id="editOrderContent">
                <!-- Conteúdo do modal será carregado dinamicamente -->
            </div>
        </div>
    </div>

    <!-- Modal para Editar Usuário -->
    <div id="editUserModal" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Editar Usuário</h3>
                <button class="modal-close" onclick="closeEditUserModal()">&times;</button>
            </div>
            <form id="editUserForm">
                <div class="form-group">
                    <label for="editUserName" class="form-label">Nome Completo</label>
                    <input type="text" id="editUserName" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="editUserLogin" class="form-label">Login</label>
                    <input type="text" id="editUserLogin" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="editUserPassword" class="form-label">Nova Senha (deixe em branco para manter a atual)</label>
                    <input type="password" id="editUserPassword" class="form-control" placeholder="Digite uma nova senha">
                </div>
                
                <div class="form-group">
                    <label for="editUserLevel" class="form-label">Nível de Acesso</label>
                    <select id="editUserLevel" class="form-control form-select" required>
                        <option value="admin">Administrador</option>
                        <option value="operator">Operador</option>
                    </select>
                </div>
                
                <input type="hidden" id="editUserId">
                
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Salvar Alterações
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditUserModal()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // CONFIGURAÇÕES DO BASEROW COM TODOS OS IDs ATUALIZADOS
        const BASEROW_CONFIG = {
            BASE_URL: 'https://api.baserow.io/api/database/rows/table/',
            TOKEN: 'qKIgfLN57iiG7V25oEFAfFkNe95DyhQ1',
            TABLES: {
                // Tabela existente: usuarios
                USERS: {
                    id: 803964,
                    fields: {
                        name: 'name_user',
                        login: 'login',
                        password: 'senha',
                        level: 'nivel'
                    }
                },
                // Tabela existente: restaurantes
                RESTAURANTS: {
                    id: 803967,
                    fields: {
                        name: 'name_restaurante',
                        address: 'endereco'
                    }
                },
                // NOVA TABELA: itens_menu
                ITEMS: {
                    id: 804085,
                    fields: {
                        name: 'nome_item',
                        description: 'descricao',
                        type: 'tipo',
                        price: 'preco',
                        restaurant_id: 'restaurante_id'
                    }
                },
                // NOVA TABELA: pedidos
                ORDERS: {
                    id: 804086,
                    fields: {
                        order_number: 'numero_pedido',
                        user_id: 'usuario_id',
                        date: 'data_pedido',
                        status: 'status',
                        total: 'total'
                    }
                },
                // NOVA TABELA: itens_pedido
                ORDER_ITEMS: {
                    id: 804088,
                    fields: {
                        order_id: 'pedido_id',
                        item_id: 'item_id',
                        quantity: 'quantidade',
                        unit_price: 'preco_unitario'
                    }
                }
            }
        };

        // Estado da aplicação
        const state = {
            currentUser: null,
            restaurants: [],
            items: [],
            users: [],
            orders: [],
            orderItems: [],
            currentOrder: {
                items: [],
                total: 0
            },
            currentFilters: {
                type: 'almoco',
                restaurant: 'all'
            },
            orderStatusFilter: 'all',
            isOnline: true,
            localData: {
                items: [],
                orders: [],
                orderItems: [],
                pendingSync: []
            },
            syncLog: []
        };

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Elementos da interface
            const loginScreen = document.getElementById('loginScreen');
            const app = document.getElementById('app');
            const loginButton = document.getElementById('loginButton');
            const logoutButton = document.getElementById('logoutButton');
            const loginUsername = document.getElementById('loginUsername');
            const loginPassword = document.getElementById('loginPassword');
            const navLinks = document.querySelectorAll('.nav-link');
            const placeOrderButton = document.getElementById('placeOrderButton');
            const itemForm = document.getElementById('itemForm');
            const restaurantForm = document.getElementById('restaurantForm');
            const userForm = document.getElementById('userForm');
            const editUserForm = document.getElementById('editUserForm');
            
            // Atualizar status da conexão
            updateConnectionStatus();
            
            // Verificar conectividade
            checkConnectivity();
            
            // Carregar dados iniciais
            initializeData();
            
            // Atualizar nome do usuário no pedido atual
            updateCurrentOrderUser();
            
            // Login
            loginButton.addEventListener('click', async function() {
                const username = loginUsername.value.trim();
                const password = loginPassword.value.trim();
                
                if (!username || !password) {
                    showAlert('Preencha todos os campos!', 'error');
                    return;
                }
                
                // Adicionar spinner ao botão
                const originalHtml = loginButton.innerHTML;
                loginButton.innerHTML = '<div class="spinner"></div> Entrando...';
                loginButton.disabled = true;
                
                try {
                    if (state.isOnline) {
                        const users = await fetchBaserowData(BASEROW_CONFIG.TABLES.USERS.id);
                        const user = users.find(u => 
                            u[BASEROW_CONFIG.TABLES.USERS.fields.login] === username && 
                            u[BASEROW_CONFIG.TABLES.USERS.fields.password] === password
                        );
                        
                        if (user) {
                            loginSuccess(user);
                        } else {
                            throw new Error('Usuário não encontrado');
                        }
                    } else {
                        const user = state.users.find(u => u.login === username && u.password === password);
                        
                        if (user) {
                            loginSuccess(user);
                        } else {
                            showAlert('Usuário ou senha incorretos!', 'error');
                        }
                    }
                } catch (error) {
                    console.error('Erro no login:', error);
                    const user = state.users.find(u => u.login === username && u.password === password);
                    
                    if (user) {
                        loginSuccess(user);
                    } else {
                        showAlert('Usuário ou senha incorretos!', 'error');
                    }
                } finally {
                    loginButton.innerHTML = originalHtml;
                    loginButton.disabled = false;
                }
                
                function loginSuccess(user) {
                    state.currentUser = {
                        id: user.id,
                        name: user[BASEROW_CONFIG.TABLES.USERS.fields.name] || user.name,
                        login: user[BASEROW_CONFIG.TABLES.USERS.fields.login] || user.login,
                        password: user[BASEROW_CONFIG.TABLES.USERS.fields.password] || user.password,
                        level: user[BASEROW_CONFIG.TABLES.USERS.fields.level] || user.level
                    };
                    
                    loginScreen.classList.add('hidden');
                    app.classList.remove('hidden');
                    updateUIForUser();
                    showAlert(`Bem-vindo, ${state.currentUser.name}!`, 'success');
                    
                    // CORREÇÃO: Atualizar o select de restaurantes APÓS o login
                    updateRestaurantSelect();
                    
                    loadRestaurantFilters();
                    loadItemsByFilters();
                    updateOrderSummary();
                    
                    // Sincronizar dados em background
                    if (state.isOnline) {
                        setTimeout(() => {
                            syncDataBackground();
                        }, 2000);
                    }
                }
            });
            
            // Logout
            logoutButton.addEventListener('click', function() {
                state.currentUser = null;
                state.currentOrder = { items: [], total: 0 };
                app.classList.add('hidden');
                loginScreen.classList.remove('hidden');
                loginUsername.value = '';
                loginPassword.value = '';
                updateOrderSummary();
                updateCurrentOrderUser();
            });
            
            // Navegação - CORREÇÃO: Chamar updateRestaurantSelect quando navegar para a seção de itens
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    const section = this.getAttribute('data-section');
                    document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
                    document.getElementById(`${section}-section`).classList.remove('hidden');
                    
                    if (section === 'order') {
                        loadRestaurantFilters();
                        loadItemsByFilters();
                    } else if (section === 'my-orders') {
                        loadMyOrders();
                    } else if (section === 'all-orders') {
                        loadAllOrders();
                    } else if (section === 'items') {
                        // CORREÇÃO: Atualizar select de restaurantes quando acessar a seção de itens
                        updateRestaurantSelect();
                        loadAdminItems();
                    } else if (section === 'restaurants') {
                        loadRestaurantsTable();
                    } else if (section === 'users') {
                        loadUsersTable();
                    } else if (section === 'sync') {
                        loadSyncDashboard();
                    }
                });
            });
            
            // Tabs de tipos de itens
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    if (this.closest('.filters-container')) {
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        
                        const type = this.getAttribute('data-type');
                        state.currentFilters.type = type;
                        loadItemsByFilters();
                    }
                });
            });
            
            // Filtros de status
            document.querySelectorAll('.status-filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.status-filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    state.orderStatusFilter = this.getAttribute('data-status');
                    
                    const currentSection = document.querySelector('.section:not(.hidden)').id;
                    if (currentSection === 'my-orders-section') {
                        loadMyOrders();
                    } else if (currentSection === 'all-orders-section') {
                        loadAllOrders();
                    }
                });
            });
            
            // Finalizar pedido
            placeOrderButton.addEventListener('click', async function() {
                if (state.currentOrder.items.length === 0) {
                    showAlert('Adicione itens ao pedido antes de finalizar!', 'error');
                    return;
                }
                
                const orderNumber = 'PED' + Date.now().toString().slice(-8);
                const order = {
                    id: Date.now(),
                    numero_pedido: orderNumber,
                    userId: state.currentUser.id,
                    userName: state.currentUser.name,
                    items: [...state.currentOrder.items],
                    total: state.currentOrder.total,
                    date: new Date().toLocaleString('pt-BR'),
                    date_iso: new Date().toISOString(),
                    status: 'pending'
                };
                
                // Adicionar ao estado local
                state.orders.push(order);
                state.localData.orders.push(order);
                
                // Criar itens do pedido
                const orderItems = order.items.map((item, index) => ({
                    id: Date.now() + index,
                    pedido_id: order.id,
                    item_id: item.id,
                    quantidade: 1,
                    preco_unitario: item.price
                }));
                
                state.orderItems.push(...orderItems);
                state.localData.orderItems.push(...orderItems);
                
                // Tentar salvar no Baserow se online
                if (state.isOnline) {
                    try {
                        await saveOrderToBaserow(order, orderItems);
                        showAlert('Pedido salvo no servidor!', 'success');
                    } catch (error) {
                        console.error('Erro ao salvar pedido:', error);
                        state.localData.pendingSync.push({
                            type: 'order',
                            data: { order, orderItems },
                            timestamp: new Date().toISOString()
                        });
                        showAlert('Pedido salvo localmente (será sincronizado depois)', 'warning');
                    }
                } else {
                    state.localData.pendingSync.push({
                        type: 'order',
                        data: { order, orderItems },
                        timestamp: new Date().toISOString()
                    });
                    showAlert('Pedido salvo localmente (modo offline)', 'warning');
                }
                
                saveLocalData();
                
                state.currentOrder = { items: [], total: 0 };
                updateOrderSummary();
                showAlert('Pedido realizado com sucesso! Status: Pendente', 'success');
                
                document.querySelector('[data-section="my-orders"]').click();
            });
            
            // Cadastrar item (admin) - CORREÇÃO: Melhorar tratamento do formulário
            if (itemForm) {
                itemForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const restaurantId = parseInt(document.getElementById('itemRestaurant').value);
                    const type = document.getElementById('itemType').value;
                    const name = document.getElementById('itemName').value;
                    const description = document.getElementById('itemDescription').value;
                    const price = parseFloat(document.getElementById('itemPrice').value);
                    
                    // Validações
                    if (!restaurantId || restaurantId <= 0) {
                        showAlert('Selecione um restaurante válido!', 'error');
                        return;
                    }
                    
                    if (!type) {
                        showAlert('Selecione um tipo de item!', 'error');
                        return;
                    }
                    
                    if (!name || name.trim() === '') {
                        showAlert('Digite o nome do item!', 'error');
                        return;
                    }
                    
                    if (!description || description.trim() === '') {
                        showAlert('Digite a descrição do item!', 'error');
                        return;
                    }
                    
                    if (!price || price <= 0) {
                        showAlert('Digite um preço válido!', 'error');
                        return;
                    }
                    
                    const newItem = {
                        id: Date.now(),
                        restaurantId: restaurantId,
                        type: type,
                        name: name.trim(),
                        description: description.trim(),
                        price: price
                    };
                    
                    state.items.push(newItem);
                    state.localData.items.push(newItem);
                    
                    if (state.isOnline && state.currentUser && state.currentUser.level === 'admin') {
                        try {
                            await saveItemToBaserow(newItem);
                            showAlert('Item salvo no servidor!', 'success');
                        } catch (error) {
                            console.error('Erro ao salvar item:', error);
                            state.localData.pendingSync.push({
                                type: 'item',
                                data: newItem,
                                timestamp: new Date().toISOString()
                            });
                            showAlert('Item salvo localmente (será sincronizado depois)', 'warning');
                        }
                    } else if (state.currentUser && state.currentUser.level === 'admin') {
                        state.localData.pendingSync.push({
                            type: 'item',
                            data: newItem,
                            timestamp: new Date().toISOString()
                        });
                        showAlert('Item salvo localmente (modo offline)', 'warning');
                    }
                    
                    saveLocalData();
                    
                    itemForm.reset();
                    loadAdminItems();
                    loadRestaurantFilters();
                    showAlert('Item cadastrado com sucesso!', 'success');
                });
            }
            
            // Cadastrar restaurante (admin)
            if (restaurantForm) {
                restaurantForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('restaurantName').value.trim();
                    const address = document.getElementById('restaurantAddress').value.trim();
                    
                    if (!name) {
                        showAlert('Digite o nome do restaurante!', 'error');
                        return;
                    }
                    
                    if (!address) {
                        showAlert('Digite o endereço do restaurante!', 'error');
                        return;
                    }
                    
                    const newRestaurant = {
                        id: Date.now(),
                        name: name,
                        address: address
                    };
                    
                    state.restaurants.push(newRestaurant);
                    
                    if (state.isOnline && state.currentUser && state.currentUser.level === 'admin') {
                        try {
                            await saveToBaserow(BASEROW_CONFIG.TABLES.RESTAURANTS.id, {
                                [BASEROW_CONFIG.TABLES.RESTAURANTS.fields.name]: newRestaurant.name,
                                [BASEROW_CONFIG.TABLES.RESTAURANTS.fields.address]: newRestaurant.address
                            });
                            showAlert('Restaurante salvo no servidor!', 'success');
                        } catch (error) {
                            console.error('Erro ao salvar restaurante:', error);
                            showAlert('Erro ao salvar no servidor. Dados salvos localmente.', 'error');
                        }
                    }
                    
                    restaurantForm.reset();
                    updateRestaurantSelect();
                    loadRestaurantFilters();
                    loadRestaurantsTable();
                    showAlert('Restaurante cadastrado com sucesso!', 'success');
                });
            }
            
            // Cadastrar usuário (admin)
            if (userForm) {
                userForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById('userNameInput').value.trim();
                    const login = document.getElementById('userLogin').value.trim();
                    const password = document.getElementById('userPassword').value;
                    const level = document.getElementById('userLevelSelect').value;
                    
                    if (!name) {
                        showAlert('Digite o nome do usuário!', 'error');
                        return;
                    }
                    
                    if (!login) {
                        showAlert('Digite o login do usuário!', 'error');
                        return;
                    }
                    
                    if (!password) {
                        showAlert('Digite a senha do usuário!', 'error');
                        return;
                    }
                    
                    if (!level) {
                        showAlert('Selecione o nível de acesso!', 'error');
                        return;
                    }
                    
                    const newUser = {
                        id: Date.now(),
                        name: name,
                        login: login,
                        password: password,
                        level: level
                    };
                    
                    state.users.push(newUser);
                    
                    if (state.isOnline && state.currentUser && state.currentUser.level === 'admin') {
                        try {
                            await saveToBaserow(BASEROW_CONFIG.TABLES.USERS.id, {
                                [BASEROW_CONFIG.TABLES.USERS.fields.name]: newUser.name,
                                [BASEROW_CONFIG.TABLES.USERS.fields.login]: newUser.login,
                                [BASEROW_CONFIG.TABLES.USERS.fields.password]: newUser.password,
                                [BASEROW_CONFIG.TABLES.USERS.fields.level]: newUser.level
                            });
                            showAlert('Usuário salvo no servidor!', 'success');
                        } catch (error) {
                            console.error('Erro ao salvar usuário:', error);
                            showAlert('Erro ao salvar no servidor. Dados salvos localmente.', 'error');
                        }
                    }
                    
                    userForm.reset();
                    loadUsersTable();
                    showAlert('Usuário cadastrado com sucesso!', 'success');
                });
            }
            
            // Editar usuário (admin)
            if (editUserForm) {
                editUserForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const userId = parseInt(document.getElementById('editUserId').value);
                    const userIndex = state.users.findIndex(u => u.id === userId);
                    
                    if (userIndex >= 0) {
                        const user = state.users[userIndex];
                        user.name = document.getElementById('editUserName').value;
                        user.login = document.getElementById('editUserLogin').value;
                        
                        const newPassword = document.getElementById('editUserPassword').value;
                        if (newPassword) {
                            user.password = newPassword;
                        }
                        
                        user.level = document.getElementById('editUserLevel').value;
                        
                        if (state.isOnline && state.currentUser && state.currentUser.level === 'admin') {
                            try {
                                await updateInBaserow(BASEROW_CONFIG.TABLES.USERS.id, userId, {
                                    [BASEROW_CONFIG.TABLES.USERS.fields.name]: user.name,
                                    [BASEROW_CONFIG.TABLES.USERS.fields.login]: user.login,
                                    [BASEROW_CONFIG.TABLES.USERS.fields.password]: user.password,
                                    [BASEROW_CONFIG.TABLES.USERS.fields.level]: user.level
                                });
                                showAlert('Usuário atualizado no servidor!', 'success');
                            } catch (error) {
                                console.error('Erro ao atualizar usuário:', error);
                                showAlert('Erro ao atualizar no servidor. Alterações salvas localmente.', 'error');
                            }
                        }
                        
                        loadUsersTable();
                        closeEditUserModal();
                        showAlert('Usuário atualizado com sucesso!', 'success');
                    }
                });
            }
            
            loginPassword.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    loginButton.click();
                }
            });
            
            // Sincronização automática
            setInterval(() => {
                if (state.isOnline && state.currentUser) {
                    syncDataBackground();
                }
            }, 5 * 60 * 1000);
        });
        
        // ========== FUNÇÕES DE INTEGRAÇÃO BASEROW ==========
        
        async function fetchBaserowData(tableId) {
            if (!tableId) {
                throw new Error('Table ID não configurado');
            }
            
            try {
                const response = await fetch(
                    `${BASEROW_CONFIG.BASE_URL}${tableId}/?user_field_names=true&size=200`,
                    {
                        headers: {
                            'Authorization': `Token ${BASEROW_CONFIG.TOKEN}`
                        }
                    }
                );
                
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                return data.results;
            } catch (error) {
                console.error(`Erro ao buscar dados da tabela ${tableId}:`, error);
                state.isOnline = false;
                throw error;
            }
        }
        
        async function saveToBaserow(tableId, data) {
            try {
                const response = await fetch(
                    `${BASEROW_CONFIG.BASE_URL}${tableId}/?user_field_names=true`,
                    {
                        method: 'POST',
                        headers: {
                            'Authorization': `Token ${BASEROW_CONFIG.TOKEN}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    }
                );
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Erro HTTP ${response.status}: ${errorText}`);
                }
                
                const result = await response.json();
                addToSyncLog(`✅ Dados salvos na tabela ${tableId}`, 'success');
                return result;
            } catch (error) {
                console.error('Erro ao salvar no Baserow:', error);
                addToSyncLog(`❌ Erro ao salvar na tabela ${tableId}: ${error.message}`, 'error');
                throw error;
            }
        }
        
        async function updateInBaserow(tableId, rowId, data) {
            try {
                const response = await fetch(
                    `${BASEROW_CONFIG.BASE_URL}${tableId}/${rowId}/?user_field_names=true`,
                    {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `Token ${BASEROW_CONFIG.TOKEN}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    }
                );
                
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                
                const result = await response.json();
                addToSyncLog(`✅ Dados atualizados na tabela ${tableId} (ID: ${rowId})`, 'success');
                return result;
            } catch (error) {
                console.error('Erro ao atualizar no Baserow:', error);
                addToSyncLog(`❌ Erro ao atualizar na tabela ${tableId}: ${error.message}`, 'error');
                throw error;
            }
        }
        
        async function deleteFromBaserow(tableId, rowId) {
            try {
                const response = await fetch(
                    `${BASEROW_CONFIG.BASE_URL}${tableId}/${rowId}/`,
                    {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Token ${BASEROW_CONFIG.TOKEN}`
                        }
                    }
                );
                
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                
                addToSyncLog(`✅ Dados excluídos da tabela ${tableId} (ID: ${rowId})`, 'success');
                return true;
            } catch (error) {
                console.error('Erro ao excluir do Baserow:', error);
                addToSyncLog(`❌ Erro ao excluir da tabela ${tableId}: ${error.message}`, 'error');
                throw error;
            }
        }
        
        // Salvar item no Baserow
        async function saveItemToBaserow(item) {
            if (!BASEROW_CONFIG.TABLES.ITEMS.id) {
                throw new Error('ID da tabela de itens não configurado');
            }
            
            const itemData = {
                [BASEROW_CONFIG.TABLES.ITEMS.fields.name]: item.name,
                [BASEROW_CONFIG.TABLES.ITEMS.fields.description]: item.description,
                [BASEROW_CONFIG.TABLES.ITEMS.fields.type]: item.type,
                [BASEROW_CONFIG.TABLES.ITEMS.fields.price]: item.price.toFixed(2),
                [BASEROW_CONFIG.TABLES.ITEMS.fields.restaurant_id]: item.restaurantId
            };
            
            return await saveToBaserow(BASEROW_CONFIG.TABLES.ITEMS.id, itemData);
        }
        
        // Salvar pedido no Baserow
        async function saveOrderToBaserow(order, orderItems) {
            if (!BASEROW_CONFIG.TABLES.ORDERS.id || !BASEROW_CONFIG.TABLES.ORDER_ITEMS.id) {
                throw new Error('IDs das tabelas de pedidos não configurados');
            }
            
            // Salvar pedido principal
            const orderData = {
                [BASEROW_CONFIG.TABLES.ORDERS.fields.order_number]: order.numero_pedido,
                [BASEROW_CONFIG.TABLES.ORDERS.fields.user_id]: order.userId,
                [BASEROW_CONFIG.TABLES.ORDERS.fields.date]: order.date_iso,
                [BASEROW_CONFIG.TABLES.ORDERS.fields.status]: order.status,
                [BASEROW_CONFIG.TABLES.ORDERS.fields.total]: order.total.toFixed(2)
            };
            
            const savedOrder = await saveToBaserow(BASEROW_CONFIG.TABLES.ORDERS.id, orderData);
            
            // Salvar itens do pedido
            for (const item of orderItems) {
                const orderItemData = {
                    [BASEROW_CONFIG.TABLES.ORDER_ITEMS.fields.order_id]: savedOrder.id,
                    [BASEROW_CONFIG.TABLES.ORDER_ITEMS.fields.item_id]: item.item_id,
                    [BASEROW_CONFIG.TABLES.ORDER_ITEMS.fields.quantity]: item.quantidade,
                    [BASEROW_CONFIG.TABLES.ORDER_ITEMS.fields.unit_price]: item.preco_unitario.toFixed(2)
                };
                
                await saveToBaserow(BASEROW_CONFIG.TABLES.ORDER_ITEMS.id, orderItemData);
            }
            
            return savedOrder;
        }
        
        // ========== FUNÇÕES DE SINCRONIZAÇÃO ==========
        
        async function syncDataBackground() {
            if (!state.isOnline) return;
            
            try {
                addToSyncLog('🔄 Iniciando sincronização em background...', 'info');
                
                await syncPendingData();
                
                await Promise.all([
                    syncUsersFromServer(),
                    syncRestaurantsFromServer(),
                    syncItemsFromServer(),
                    syncOrdersFromServer()
                ]);
                
                // CORREÇÃO: Atualizar o select de restaurantes após sincronização
                updateRestaurantSelect();
                
                addToSyncLog('✅ Sincronização em background concluída', 'success');
                updateSyncDashboard();
            } catch (error) {
                console.error('Erro na sincronização:', error);
                addToSyncLog(`❌ Erro na sincronização: ${error.message}`, 'error');
            }
        }
        
        async function syncPendingData() {
            if (state.localData.pendingSync.length === 0) return;
            
            addToSyncLog(`📦 Sincronizando ${state.localData.pendingSync.length} itens pendentes...`, 'info');
            
            const successfulSyncs = [];
            
            for (let i = state.localData.pendingSync.length - 1; i >= 0; i--) {
                const pending = state.localData.pendingSync[i];
                
                try {
                    if (pending.type === 'order') {
                        await saveOrderToBaserow(pending.data.order, pending.data.orderItems);
                    } else if (pending.type === 'item') {
                        await saveItemToBaserow(pending.data);
                    }
                    
                    successfulSyncs.push(i);
                    addToSyncLog(`✅ ${pending.type} sincronizado com sucesso`, 'success');
                } catch (error) {
                    console.error(`Erro ao sincronizar ${pending.type}:`, error);
                    addToSyncLog(`❌ Erro ao sincronizar ${pending.type}`, 'error');
                }
            }
            
            successfulSyncs.forEach(index => {
                state.localData.pendingSync.splice(index, 1);
            });
            
            saveLocalData();
        }
        
        async function syncUsersFromServer() {
            try {
                const users = await fetchBaserowData(BASEROW_CONFIG.TABLES.USERS.id);
                state.users = users.map(user => ({
                    id: user.id,
                    name: user[BASEROW_CONFIG.TABLES.USERS.fields.name],
                    login: user[BASEROW_CONFIG.TABLES.USERS.fields.login],
                    password: user[BASEROW_CONFIG.TABLES.USERS.fields.password],
                    level: user[BASEROW_CONFIG.TABLES.USERS.fields.level]
                }));
                addToSyncLog(`✅ ${state.users.length} usuários sincronizados`, 'success');
            } catch (error) {
                addToSyncLog(`❌ Erro ao sincronizar usuários: ${error.message}`, 'error');
            }
        }
        
        async function syncRestaurantsFromServer() {
            try {
                const restaurants = await fetchBaserowData(BASEROW_CONFIG.TABLES.RESTAURANTS.id);
                state.restaurants = restaurants.map(restaurant => ({
                    id: restaurant.id,
                    name: restaurant[BASEROW_CONFIG.TABLES.RESTAURANTS.fields.name],
                    address: restaurant[BASEROW_CONFIG.TABLES.RESTAURANTS.fields.address]
                }));
                addToSyncLog(`✅ ${state.restaurants.length} restaurantes sincronizados`, 'success');
            } catch (error) {
                addToSyncLog(`❌ Erro ao sincronizar restaurantes: ${error.message}`, 'error');
            }
        }
        
        async function syncItemsFromServer() {
            if (!BASEROW_CONFIG.TABLES.ITEMS.id) {
                addToSyncLog('⚠️ Tabela de itens não configurada', 'warning');
                return;
            }
            
            try {
                const items = await fetchBaserowData(BASEROW_CONFIG.TABLES.ITEMS.id);
                state.items = items.map(item => ({
                    id: item.id,
                    restaurantId: item[BASEROW_CONFIG.TABLES.ITEMS.fields.restaurant_id],
                    type: item[BASEROW_CONFIG.TABLES.ITEMS.fields.type],
                    name: item[BASEROW_CONFIG.TABLES.ITEMS.fields.name],
                    description: item[BASEROW_CONFIG.TABLES.ITEMS.fields.description],
                    price: parseFloat(item[BASEROW_CONFIG.TABLES.ITEMS.fields.price])
                }));
                
                // Atualizar dados locais
                state.localData.items = [...state.items];
                saveLocalData();
                
                addToSyncLog(`✅ ${state.items.length} itens sincronizados`, 'success');
            } catch (error) {
                addToSyncLog(`❌ Erro ao sincronizar itens: ${error.message}`, 'error');
            }
        }
        
        async function syncOrdersFromServer() {
            if (!BASEROW_CONFIG.TABLES.ORDERS.id || !BASEROW_CONFIG.TABLES.ORDER_ITEMS.id) {
                addToSyncLog('⚠️ Tabelas de pedidos não configuradas', 'warning');
                return;
            }
            
            try {
                const orders = await fetchBaserowData(BASEROW_CONFIG.TABLES.ORDERS.id);
                const orderItems = await fetchBaserowData(BASEROW_CONFIG.TABLES.ORDER_ITEMS.id);
                
                state.orders = orders.map(order => ({
                    id: order.id,
                    numero_pedido: order[BASEROW_CONFIG.TABLES.ORDERS.fields.order_number],
                    userId: order[BASEROW_CONFIG.TABLES.ORDERS.fields.user_id],
                    userName: 'Cliente',
                    total: parseFloat(order[BASEROW_CONFIG.TABLES.ORDERS.fields.total]),
                    date: new Date(order[BASEROW_CONFIG.TABLES.ORDERS.fields.date]).toLocaleString('pt-BR'),
                    date_iso: order[BASEROW_CONFIG.TABLES.ORDERS.fields.date],
                    status: order[BASEROW_CONFIG.TABLES.ORDERS.fields.status]
                }));
                
                state.orderItems = orderItems.map(item => ({
                    id: item.id,
                    pedido_id: item[BASEROW_CONFIG.TABLES.ORDER_ITEMS.fields.order_id],
                    item_id: item[BASEROW_CONFIG.TABLES.ORDER_ITEMS.fields.item_id],
                    quantidade: item[BASEROW_CONFIG.TABLES.ORDER_ITEMS.fields.quantity],
                    preco_unitario: parseFloat(item[BASEROW_CONFIG.TABLES.ORDER_ITEMS.fields.unit_price])
                }));
                
                addToSyncLog(`✅ ${state.orders.length} pedidos sincronizados`, 'success');
            } catch (error) {
                addToSyncLog(`❌ Erro ao sincronizar pedidos: ${error.message}`, 'error');
            }
        }
        
        // ========== FUNÇÕES DE CONTROLE DE SINCRONIZAÇÃO ==========
        
        window.forceSync = async function() {
            if (!state.isOnline) {
                showAlert('Você está offline. Conecte-se à internet para sincronizar.', 'error');
                return;
            }
            
            const syncButton = document.getElementById('syncButton');
            const originalHtml = syncButton.innerHTML;
            syncButton.innerHTML = '<div class="spinner"></div>';
            syncButton.disabled = true;
            
            try {
                await syncAllData();
                showAlert('Sincronização concluída com sucesso!', 'success');
            } catch (error) {
                showAlert('Erro na sincronização: ' + error.message, 'error');
            } finally {
                syncButton.innerHTML = originalHtml;
                syncButton.disabled = false;
            }
        };
        
        async function syncAllData() {
            addToSyncLog('🔄 Iniciando sincronização completa...', 'info');
            
            await Promise.all([
                syncUsers(),
                syncRestaurants(),
                syncItems(),
                syncOrders(),
                syncPendingData()
            ]);
            
            // CORREÇÃO: Atualizar o select após sincronização completa
            updateRestaurantSelect();
            
            addToSyncLog('✅ Sincronização completa concluída', 'success');
            updateSyncDashboard();
        }
        
        window.syncUsers = async function() {
            addToSyncLog('🔄 Sincronizando usuários...', 'info');
            await syncUsersFromServer();
            loadUsersTable();
        };
        
        window.syncRestaurants = async function() {
            addToSyncLog('🔄 Sincronizando restaurantes...', 'info');
            await syncRestaurantsFromServer();
            updateRestaurantSelect();
            loadRestaurantFilters();
            loadRestaurantsTable();
        };
        
        window.syncItems = async function() {
            addToSyncLog('🔄 Sincronizando itens...', 'info');
            await syncItemsFromServer();
            loadAdminItems();
            loadItemsByFilters();
        };
        
        window.syncOrders = async function() {
            addToSyncLog('🔄 Sincronizando pedidos...', 'info');
            await syncOrdersFromServer();
            loadMyOrders();
            loadAllOrders();
        };
        
        // ========== FUNÇÕES DE LOG DE SINCRONIZAÇÃO ==========
        
        function addToSyncLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            const logEntry = {
                timestamp,
                message,
                type
            };
            
            state.syncLog.unshift(logEntry);
            
            if (state.syncLog.length > 100) {
                state.syncLog.pop();
            }
            
            if (document.getElementById('sync-section') && !document.getElementById('sync-section').classList.contains('hidden')) {
                displaySyncLog();
            }
        }
        
        function displaySyncLog() {
            const logContainer = document.getElementById('syncLog');
            if (!logContainer) return;
            
            if (state.syncLog.length === 0) {
                logContainer.innerHTML = '<div style="color: #aaa; text-align: center; padding: 20px;">Nenhuma atividade de sincronização ainda.</div>';
                return;
            }
            
            logContainer.innerHTML = state.syncLog.map(entry => {
                const color = entry.type === 'success' ? 'var(--success)' : 
                             entry.type === 'error' ? 'var(--danger)' : 
                             entry.type === 'warning' ? 'var(--warning)' : 'var(--primary)';
                
                return `
                    <div class="log-entry">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: ${color}; font-weight: 600;">${entry.message}</span>
                            <span class="log-timestamp">${entry.timestamp}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        window.clearSyncLog = function() {
            if (confirm('Tem certeza que deseja limpar o log de sincronização?')) {
                state.syncLog = [];
                displaySyncLog();
                showAlert('Log de sincronização limpo', 'success');
            }
        };
        
        window.exportSyncLog = function() {
            const logText = state.syncLog.map(entry => 
                `[${entry.timestamp}] ${entry.message}`
            ).join('\n');
            
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `sync-log-${new Date().toISOString().slice(0, 10)}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showAlert('Log exportado com sucesso', 'success');
        };
        
        // ========== FUNÇÕES DE DASHBOARD DE SINCRONIZAÇÃO ==========
        
        function loadSyncDashboard() {
            updateSyncDashboard();
            displaySyncLog();
        }
        
        function updateSyncDashboard() {
            const statusIndicator = document.getElementById('syncStatusIndicator');
            const statusText = document.getElementById('syncStatusText');
            const lastUpdate = document.getElementById('syncLastUpdate');
            
            if (state.isOnline) {
                statusIndicator.className = 'status-indicator status-online';
                statusText.textContent = 'Conectado ao Baserow';
                statusText.style.color = 'var(--success)';
            } else {
                statusIndicator.className = 'status-indicator status-offline';
                statusText.textContent = 'Modo Offline';
                statusText.style.color = 'var(--warning)';
            }
            
            document.getElementById('statUsers').textContent = state.users.length;
            document.getElementById('statRestaurants').textContent = state.restaurants.length;
            document.getElementById('statItems').textContent = state.items.length;
            document.getElementById('statOrders').textContent = state.orders.length;
            document.getElementById('statPending').textContent = state.localData.pendingSync.length;
            
            const lastSync = state.syncLog.find(entry => entry.type === 'success');
            if (lastSync) {
                lastUpdate.textContent = `Última sincronização: ${lastSync.timestamp}`;
            } else {
                lastUpdate.textContent = 'Última sincronização: Nunca';
            }
            
            const syncText = document.getElementById('syncText');
            if (state.localData.pendingSync.length > 0) {
                syncText.innerHTML = `Online <span class="badge-sync">${state.localData.pendingSync.length} pendente(s)</span>`;
            } else {
                syncText.textContent = state.isOnline ? 'Online' : 'Offline';
            }
        }
        
        // ========== FUNÇÕES DE TESTE DE CONEXÃO ==========
        
        async function testBaserowConnection() {
            addToSyncLog('🔌 Testando conexão com Baserow...', 'info');
            
            try {
                // Testar conexão com a tabela de usuários
                const response = await fetch(
                    `${BASEROW_CONFIG.BASE_URL}${BASEROW_CONFIG.TABLES.USERS.id}/?user_field_names=true&size=1`,
                    {
                        headers: {
                            'Authorization': `Token ${BASEROW_CONFIG.TOKEN}`
                        }
                    }
                );
                
                if (response.ok) {
                    addToSyncLog('✅ Conexão com Baserow estabelecida com sucesso!', 'success');
                    showAlert('Conexão com Baserow funcionando perfeitamente!', 'success');
                    
                    // Testar todas as tabelas
                    await testAllTables();
                } else {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
            } catch (error) {
                addToSyncLog(`❌ Falha na conexão com Baserow: ${error.message}`, 'error');
                showAlert(`Erro na conexão: ${error.message}`, 'error');
            }
        }
        
        async function testAllTables() {
            const tables = [
                { name: 'Usuários', id: BASEROW_CONFIG.TABLES.USERS.id },
                { name: 'Restaurantes', id: BASEROW_CONFIG.TABLES.RESTAURANTS.id },
                { name: 'Itens Menu', id: BASEROW_CONFIG.TABLES.ITEMS.id },
                { name: 'Pedidos', id: BASEROW_CONFIG.TABLES.ORDERS.id },
                { name: 'Itens Pedido', id: BASEROW_CONFIG.TABLES.ORDER_ITEMS.id }
            ];
            
            for (const table of tables) {
                try {
                    const response = await fetch(
                        `${BASEROW_CONFIG.BASE_URL}${table.id}/?user_field_names=true&size=1`,
                        {
                            headers: {
                                'Authorization': `Token ${BASEROW_CONFIG.TOKEN}`
                            }
                        }
                    );
                    
                    if (response.ok) {
                        addToSyncLog(`✅ Tabela "${table.name}" acessível`, 'success');
                    } else {
                        addToSyncLog(`⚠️ Tabela "${table.name}" com problemas`, 'warning');
                    }
                } catch (error) {
                    addToSyncLog(`❌ Erro na tabela "${table.name}"`, 'error');
                }
            }
        }
        
        // ========== FUNÇÕES AUXILIARES ==========
        
        function updateConnectionStatus() {
            const statusText = document.getElementById('statusText');
            const connectionStatus = document.getElementById('connectionStatus');
            
            if (navigator.onLine) {
                statusText.textContent = 'Conectado ao servidor';
                statusText.style.color = 'var(--success)';
                connectionStatus.style.border = '1px solid var(--success)';
            } else {
                statusText.textContent = 'Modo offline (dados locais)';
                statusText.style.color = 'var(--warning)';
                connectionStatus.style.border = '1px solid var(--warning)';
            }
        }
        
        function checkConnectivity() {
            state.isOnline = navigator.onLine;
            
            window.addEventListener('online', () => {
                state.isOnline = true;
                updateConnectionStatus();
                updateUIForUser();
                showAlert('Conexão restaurada! Sincronizando dados...', 'success');
                setTimeout(() => syncDataBackground(), 1000);
            });
            
            window.addEventListener('offline', () => {
                state.isOnline = false;
                updateConnectionStatus();
                updateUIForUser();
                showAlert('Modo offline ativado. Trabalhando com dados locais.', 'warning');
            });
            
            setInterval(() => {
                const wasOnline = state.isOnline;
                state.isOnline = navigator.onLine;
                
                if (wasOnline !== state.isOnline) {
                    updateConnectionStatus();
                    updateUIForUser();
                    
                    if (state.isOnline) {
                        showAlert('Conexão restaurada!', 'success');
                        setTimeout(() => syncDataBackground(), 1000);
                    } else {
                        showAlert('Conexão perdida. Modo offline.', 'warning');
                    }
                }
            }, 5000);
        }
        
        async function initializeData() {
            loadLocalData();
            
            if (state.isOnline) {
                try {
                    await Promise.all([
                        loadUsersFromBaserow(),
                        loadRestaurantsFromBaserow(),
                        loadItemsFromBaserow()
                    ]);
                    addToSyncLog('✅ Dados iniciais carregados do Baserow', 'success');
                } catch (error) {
                    console.log('Usando dados locais');
                    loadDefaultData();
                }
            } else {
                loadDefaultData();
            }
        }
        
        async function loadUsersFromBaserow() {
            const users = await fetchBaserowData(BASEROW_CONFIG.TABLES.USERS.id);
            state.users = users.map(user => ({
                id: user.id,
                name: user[BASEROW_CONFIG.TABLES.USERS.fields.name],
                login: user[BASEROW_CONFIG.TABLES.USERS.fields.login],
                password: user[BASEROW_CONFIG.TABLES.USERS.fields.password],
                level: user[BASEROW_CONFIG.TABLES.USERS.fields.level]
            }));
        }
        
        async function loadRestaurantsFromBaserow() {
            const restaurants = await fetchBaserowData(BASEROW_CONFIG.TABLES.RESTAURANTS.id);
            state.restaurants = restaurants.map(restaurant => ({
                id: restaurant.id,
                name: restaurant[BASEROW_CONFIG.TABLES.RESTAURANTS.fields.name],
                address: restaurant[BASEROW_CONFIG.TABLES.RESTAURANTS.fields.address]
            }));
        }
        
        async function loadItemsFromBaserow() {
            if (!BASEROW_CONFIG.TABLES.ITEMS.id) {
                if (state.localData.items.length > 0) {
                    state.items = [...state.localData.items];
                }
                return;
            }
            
            try {
                const items = await fetchBaserowData(BASEROW_CONFIG.TABLES.ITEMS.id);
                state.items = items.map(item => ({
                    id: item.id,
                    restaurantId: item[BASEROW_CONFIG.TABLES.ITEMS.fields.restaurant_id],
                    type: item[BASEROW_CONFIG.TABLES.ITEMS.fields.type],
                    name: item[BASEROW_CONFIG.TABLES.ITEMS.fields.name],
                    description: item[BASEROW_CONFIG.TABLES.ITEMS.fields.description],
                    price: parseFloat(item[BASEROW_CONFIG.TABLES.ITEMS.fields.price])
                }));
                
                state.localData.items = [...state.items];
                saveLocalData();
            } catch (error) {
                console.error('Erro ao carregar itens:', error);
                if (state.localData.items.length > 0) {
                    state.items = [...state.localData.items];
                }
            }
        }
        
        function loadDefaultData() {
            if (state.users.length === 0) {
                state.users = [
                    { id: 1, name: "Administrador", login: "admin", password: "motos2026", level: "admin" },
                    { id: 2, name: "Operador", login: "operador", password: "operador123", level: "operator" }
                ];
            }
            
            if (state.restaurants.length === 0) {
                state.restaurants = [
                    { id: 1, name: "Quantum Steakhouse", address: "Av. Tecnológica, 123 - Centro" },
                    { id: 2, name: "Nexus Sushi", address: "R. Holográfica, 456 - Nova Era" },
                    { id: 3, name: "Cyber Pizzeria", address: "R. Digital, 789 - Setor Futuro" }
                ];
            }
            
            if (state.items.length === 0 && state.localData.items.length === 0) {
                state.items = [
                    {
                        id: 1,
                        restaurantId: 1,
                        type: "almoco",
                        name: "Filé Mignon Quantico",
                        description: "Filé mignon grelhado com molho de vinho tinto e acompanhamentos futuristas",
                        price: 89.90
                    },
                    {
                        id: 2,
                        restaurantId: 2,
                        type: "almoco",
                        name: "Combinado Nexus",
                        description: "Sushi e sashimi selecionados com toques tecnológicos",
                        price: 65.50
                    },
                    {
                        id: 3,
                        restaurantId: 3,
                        type: "lanche",
                        name: "Pizza Holográfica",
                        description: "Pizza com ingredientes que mudam de sabor conforme cada fatia",
                        price: 49.90
                    }
                ];
                state.localData.items = [...state.items];
                saveLocalData();
            }
        }
        
        function loadLocalData() {
            const savedData = localStorage.getItem('2m_motos_system_data');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    state.localData.items = data.items || [];
                    state.localData.orders = data.orders || [];
                    state.localData.orderItems = data.orderItems || [];
                    state.localData.pendingSync = data.pendingSync || [];
                    
                    if (state.localData.items.length > 0) {
                        state.items = [...state.localData.items];
                    }
                    
                    if (state.localData.orders.length > 0) {
                        state.orders = [...state.localData.orders];
                    }
                    
                    if (state.localData.orderItems.length > 0) {
                        state.orderItems = [...state.localData.orderItems];
                    }
                } catch (error) {
                    console.error('Erro ao carregar dados locais:', error);
                }
            }
        }
        
        function saveLocalData() {
            const dataToSave = {
                items: state.localData.items,
                orders: state.localData.orders,
                orderItems: state.localData.orderItems,
                pendingSync: state.localData.pendingSync,
                lastSync: new Date().toISOString()
            };
            
            try {
                localStorage.setItem('2m_motos_system_data', JSON.stringify(dataToSave));
            } catch (error) {
                console.error('Erro ao salvar dados locais:', error);
            }
        }
        
        // ========== FUNÇÕES DE UI ==========
        
        function updateUIForUser() {
            if (!state.currentUser) return;
            
            const user = state.currentUser;
            
            document.getElementById('userName').textContent = user.name;
            document.getElementById('userLevel').textContent = user.level === 'admin' ? 'Administrador' : 'Operador';
            document.getElementById('userAvatar').textContent = user.name.charAt(0).toUpperCase();
            
            const syncText = document.getElementById('syncText');
            const statusIndicator = document.getElementById('statusIndicator');
            
            if (state.isOnline) {
                statusIndicator.className = 'status-indicator status-online';
                if (state.localData.pendingSync.length > 0) {
                    syncText.innerHTML = `Online <span class="badge-sync">${state.localData.pendingSync.length} pendente(s)</span>`;
                } else {
                    syncText.textContent = 'Online';
                }
            } else {
                statusIndicator.className = 'status-indicator status-offline';
                syncText.textContent = 'Offline';
            }
            
            const adminElements = document.querySelectorAll('.admin-only');
            if (user.level === 'admin') {
                adminElements.forEach(el => el.classList.remove('hidden'));
            } else {
                adminElements.forEach(el => el.classList.add('hidden'));
            }
            
            updateCurrentOrderUser();
        }
        
        function updateCurrentOrderUser() {
            const currentOrderUser = document.getElementById('currentOrderUser');
            if (state.currentUser) {
                currentOrderUser.textContent = `Pedido de: ${state.currentUser.name}`;
            } else {
                currentOrderUser.textContent = '';
            }
        }
        
        function loadRestaurantFilters() {
            const container = document.getElementById('restaurantFilters');
            if (!container) return;
            
            if (state.restaurants.length === 0) {
                container.innerHTML = '<p style="color: #aaa;">Nenhum restaurante cadastrado</p>';
                return;
            }
            
            let filtersHTML = `
                <button class="btn-filter ${state.currentFilters.restaurant === 'all' ? 'active' : ''}" 
                        data-restaurant="all" onclick="filterByRestaurant('all')">
                    <i class="fas fa-globe"></i> Todos os Restaurantes
                </button>
            `;
            
            state.restaurants.forEach(restaurant => {
                const hasItems = state.items.some(item => 
                    item.restaurantId === restaurant.id && 
                    item.type === state.currentFilters.type
                );
                
                if (hasItems || state.currentFilters.type === 'all') {
                    filtersHTML += `
                        <button class="btn-filter ${state.currentFilters.restaurant == restaurant.id ? 'active' : ''}" 
                                data-restaurant="${restaurant.id}" onclick="filterByRestaurant(${restaurant.id})">
                            <i class="fas fa-store"></i> ${restaurant.name}
                        </button>
                    `;
                }
            });
            
            container.innerHTML = filtersHTML;
        }
        
        window.filterByRestaurant = function(restaurantId) {
            state.currentFilters.restaurant = restaurantId;
            loadItemsByFilters();
            
            document.querySelectorAll('.btn-filter').forEach(btn => {
                const btnRestaurantId = btn.getAttribute('data-restaurant');
                if (btnRestaurantId == restaurantId) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }
        
        function loadItemsByFilters() {
            const container = document.getElementById('itemsContainer');
            if (!container) return;
            
            let filteredItems = state.items.filter(item => {
                if (state.currentFilters.type !== 'all' && item.type !== state.currentFilters.type) {
                    return false;
                }
                
                if (state.currentFilters.restaurant !== 'all' && item.restaurantId != state.currentFilters.restaurant) {
                    return false;
                }
                
                return true;
            });
            
            loadRestaurantFilters();
            
            if (filteredItems.length === 0) {
                container.innerHTML = `
                    <div class="no-items">
                        <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 15px; color: var(--primary);"></i>
                        <h3>Nenhum item encontrado</h3>
                        <p>Não há itens disponíveis com os filtros selecionados.</p>
                        <button class="btn-filter" onclick="resetFilters()" style="margin-top: 15px;">
                            <i class="fas fa-redo"></i> Limpar Filtros
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filteredItems.map(item => {
                const restaurant = state.restaurants.find(r => r.id === item.restaurantId);
                const typeBadge = item.type === 'almoco' ? 'Almoço' : item.type === 'lanche' ? 'Lanche' : 'Outros';
                
                return `
                <div class="card item-card">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                        <div class="restaurant-badge">${restaurant ? restaurant.name : 'Restaurante não encontrado'}</div>
                        <div style="font-size: 0.8rem; background-color: rgba(255, 42, 109, 0.1); color: var(--secondary); padding: 3px 8px; border-radius: 4px;">
                            ${typeBadge}
                        </div>
                    </div>
                    <h3 class="card-title">${item.name}</h3>
                    <p class="card-text">${item.description}</p>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="font-weight: bold; color: var(--primary);">R$ ${item.price.toFixed(2)}</div>
                        <button class="item-select-btn ${state.currentOrder.items.some(i => i.id === item.id) ? 'item-selected' : ''}" 
                                data-id="${item.id}" onclick="toggleItemSelection(${item.id})">
                            ${state.currentOrder.items.some(i => i.id === item.id) ? '<i class="fas fa-check"></i> Selecionado' : '<i class="fas fa-plus"></i> Adicionar'}
                        </button>
                    </div>
                </div>
            `}).join('');
        }
        
        window.resetFilters = function() {
            state.currentFilters = {
                type: 'almoco',
                restaurant: 'all'
            };
            
            document.querySelectorAll('.tab').forEach(tab => {
                if (tab.getAttribute('data-type') === 'almoco') {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            loadRestaurantFilters();
            loadItemsByFilters();
        }
        
        // CORREÇÃO PRINCIPAL: Função atualizada para popular o select de restaurantes
        function updateRestaurantSelect() {
            const select = document.getElementById('itemRestaurant');
            if (!select) {
                console.log('Elemento itemRestaurant não encontrado');
                return;
            }
            
            console.log('Atualizando select de restaurantes. Total de restaurantes:', state.restaurants.length);
            
            // Salvar valor selecionado atual
            const currentValue = select.value;
            
            // Limpar opções existentes
            select.innerHTML = '<option value="">Selecione um restaurante</option>';
            
            // Adicionar restaurantes
            state.restaurants.forEach(restaurant => {
                const option = document.createElement('option');
                option.value = restaurant.id;
                option.textContent = restaurant.name;
                select.appendChild(option);
            });
            
            // Restaurar valor selecionado se ainda existir
            if (currentValue && state.restaurants.some(r => r.id == currentValue)) {
                select.value = currentValue;
            }
            
            console.log('Select de restaurantes atualizado com', state.restaurants.length, 'opções');
        }
        
        window.toggleItemSelection = function(itemId) {
            const item = state.items.find(i => i.id === itemId);
            if (!item) return;
            
            const existingIndex = state.currentOrder.items.findIndex(i => i.id === itemId);
            
            if (existingIndex >= 0) {
                state.currentOrder.items.splice(existingIndex, 1);
                state.currentOrder.total -= item.price;
            } else {
                state.currentOrder.items.push(item);
                state.currentOrder.total += item.price;
            }
            
            updateOrderSummary();
            
            const button = document.querySelector(`.item-select-btn[data-id="${itemId}"]`);
            if (button) {
                if (existingIndex >= 0) {
                    button.classList.remove('item-selected');
                    button.innerHTML = '<i class="fas fa-plus"></i> Adicionar';
                } else {
                    button.classList.add('item-selected');
                    button.innerHTML = '<i class="fas fa-check"></i> Selecionado';
                }
            }
        }
        
        function updateOrderSummary() {
            const list = document.getElementById('selectedItemsList');
            const total = document.getElementById('orderTotal');
            
            if (!list || !total) return;
            
            if (state.currentOrder.items.length === 0) {
                list.innerHTML = `<li class="selected-item"><span>Nenhum item selecionado</span></li>`;
                total.textContent = 'R$ 0,00';
                return;
            }
            
            list.innerHTML = state.currentOrder.items.map(item => {
                const restaurant = state.restaurants.find(r => r.id === item.restaurantId);
                return `
                <li class="selected-item">
                    <div>
                        <div>${item.name}</div>
                        <div class="restaurant-address">${restaurant ? restaurant.name : ''}</div>
                    </div>
                    <span>R$ ${item.price.toFixed(2)}</span>
                    <button class="remove-item" onclick="removeItemFromOrder(${item.id})">
                        <i class="fas fa-times"></i>
                    </button>
                </li>
            `}).join('');
            
            total.textContent = `R$ ${state.currentOrder.total.toFixed(2)}`;
        }
        
        window.removeItemFromOrder = function(itemId) {
            const itemIndex = state.currentOrder.items.findIndex(i => i.id === itemId);
            
            if (itemIndex >= 0) {
                const item = state.currentOrder.items[itemIndex];
                state.currentOrder.items.splice(itemIndex, 1);
                state.currentOrder.total -= item.price;
                
                updateOrderSummary();
                
                const button = document.querySelector(`.item-select-btn[data-id="${itemId}"]`);
                if (button) {
                    button.classList.remove('item-selected');
                    button.innerHTML = '<i class="fas fa-plus"></i> Adicionar';
                }
            }
        }
        
        function loadMyOrders() {
            const container = document.getElementById('myOrdersContainer');
            if (!container) return;
            
            let userOrders = state.orders.filter(order => order.userId === state.currentUser.id);
            
            if (state.orderStatusFilter !== 'all') {
                userOrders = userOrders.filter(order => order.status === state.orderStatusFilter);
            }
            
            if (userOrders.length === 0) {
                container.innerHTML = `<div class="card"><p>Nenhum pedido encontrado com os filtros selecionados.</p></div>`;
                return;
            }
            
            container.innerHTML = userOrders.map(order => {
                const statusText = order.status === 'pending' ? 'Pendente' : order.status === 'ready' ? 'Pronto' : 'Cancelado';
                const statusClass = order.status === 'pending' ? 'badge-pending' : order.status === 'ready' ? 'badge-ready' : 'badge-cancelled';
                
                const orderItems = state.orderItems.filter(oi => oi.pedido_id === order.id);
                const itemsWithDetails = orderItems.map(oi => {
                    const item = state.items.find(i => i.id === oi.item_id);
                    return item ? { ...item, quantidade: oi.quantidade } : null;
                }).filter(Boolean);
                
                return `
                <div class="card" style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <h3 class="card-title">Pedido ${order.numero_pedido || '#' + order.id}</h3>
                        <div>
                            <span class="badge-status ${statusClass}">${statusText}</span>
                            <div style="color: var(--primary); font-weight: bold; margin-top: 5px;">R$ ${order.total.toFixed(2)}</div>
                        </div>
                    </div>
                    <div class="order-details">
                        <div class="order-date">Realizado em: ${order.date}</div>
                    </div>
                    <ul style="margin-top: 15px; padding-left: 20px;">
                        ${itemsWithDetails.map(item => 
                            `<li>${item.name} (${item.quantidade}x) - R$ ${(item.price * item.quantidade).toFixed(2)}</li>`
                        ).join('')}
                    </ul>
                    ${order.status === 'pending' ? `
                        <div class="order-actions">
                            <button class="btn btn-sm btn-secondary" onclick="cancelOrder(${order.id})">
                                <i class="fas fa-times"></i> Cancelar Pedido
                            </button>
                        </div>
                    ` : ''}
                </div>
            `}).join('');
        }
        
        function loadAllOrders() {
            const container = document.getElementById('allOrdersContainer');
            if (!container) return;
            
            let allOrders = [...state.orders];
            
            if (state.orderStatusFilter !== 'all') {
                allOrders = allOrders.filter(order => order.status === state.orderStatusFilter);
            }
            
            allOrders.sort((a, b) => b.id - a.id);
            
            if (allOrders.length === 0) {
                container.innerHTML = `<div class="card"><p>Nenhum pedido encontrado com os filtros selecionados.</p></div>`;
                return;
            }
            
            container.innerHTML = allOrders.map(order => {
                const statusText = order.status === 'pending' ? 'Pendente' : order.status === 'ready' ? 'Pronto' : 'Cancelado';
                const statusClass = order.status === 'pending' ? 'badge-pending' : order.status === 'ready' ? 'badge-ready' : 'badge-cancelled';
                
                const user = state.users.find(u => u.id === order.userId);
                const orderItems = state.orderItems.filter(oi => oi.pedido_id === order.id);
                const itemsWithDetails = orderItems.map(oi => {
                    const item = state.items.find(i => i.id === oi.item_id);
                    return item ? { ...item, quantidade: oi.quantidade } : null;
                }).filter(Boolean);
                
                return `
                <div class="card" style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <div>
                            <h3 class="card-title">Pedido ${order.numero_pedido || '#' + order.id}</h3>
                            <div class="order-user">Cliente: ${user ? user.name : order.userName || 'Desconhecido'}</div>
                        </div>
                        <div>
                            <span class="badge-status ${statusClass}">${statusText}</span>
                            <div style="color: var(--primary); font-weight: bold; margin-top: 5px;">R$ ${order.total.toFixed(2)}</div>
                        </div>
                    </div>
                    <div class="order-details">
                        <div class="order-date">Realizado em: ${order.date}</div>
                    </div>
                    <ul style="margin-top: 15px; padding-left: 20px;">
                        ${itemsWithDetails.map(item => 
                            `<li>${item.name} (${item.quantidade}x) - R$ ${(item.price * item.quantidade).toFixed(2)}</li>`
                        ).join('')}
                    </ul>
                    <div class="order-actions">
                        ${order.status === 'pending' ? `
                            <button class="btn btn-sm btn-primary" onclick="markOrderAsReady(${order.id})">
                                <i class="fas fa-check"></i> Marcar como Pronto
                            </button>
                        ` : ''}
                        ${order.status !== 'cancelled' ? `
                            <button class="btn btn-sm btn-secondary" onclick="cancelOrder(${order.id})">
                                <i class="fas fa-times"></i> Cancelar Pedido
                            </button>
                        ` : ''}
                    </div>
                </div>
            `}).join('');
        }
        
        window.markOrderAsReady = function(orderId) {
            const orderIndex = state.orders.findIndex(o => o.id === orderId);
            
            if (orderIndex >= 0) {
                state.orders[orderIndex].status = 'ready';
                
                if (state.isOnline && state.currentUser && state.currentUser.level === 'admin') {
                    try {
                        updateInBaserow(BASEROW_CONFIG.TABLES.ORDERS.id, orderId, {
                            [BASEROW_CONFIG.TABLES.ORDERS.fields.status]: 'ready'
                        });
                    } catch (error) {
                        console.error('Erro ao atualizar status:', error);
                    }
                }
                
                const currentSection = document.querySelector('.section:not(.hidden)').id;
                if (currentSection === 'my-orders-section') {
                    loadMyOrders();
                } else if (currentSection === 'all-orders-section') {
                    loadAllOrders();
                }
                
                showAlert('Pedido marcado como pronto!', 'success');
            }
        }
        
        window.cancelOrder = function(orderId) {
            if (!confirm('Tem certeza que deseja cancelar este pedido?')) {
                return;
            }
            
            const orderIndex = state.orders.findIndex(o => o.id === orderId);
            
            if (orderIndex >= 0) {
                state.orders[orderIndex].status = 'cancelled';
                
                if (state.isOnline && state.currentUser && state.currentUser.level === 'admin') {
                    try {
                        updateInBaserow(BASEROW_CONFIG.TABLES.ORDERS.id, orderId, {
                            [BASEROW_CONFIG.TABLES.ORDERS.fields.status]: 'cancelled'
                        });
                    } catch (error) {
                        console.error('Erro ao cancelar pedido:', error);
                    }
                }
                
                const currentSection = document.querySelector('.section:not(.hidden)').id;
                if (currentSection === 'my-orders-section') {
                    loadMyOrders();
                } else if (currentSection === 'all-orders-section') {
                    loadAllOrders();
                }
                
                showAlert('Pedido cancelado com sucesso!', 'success');
            }
        }
        
        function loadAdminItems() {
            const container = document.getElementById('adminItemsContainer');
            if (!container) return;
            
            if (state.items.length === 0) {
                container.innerHTML = `<div class="card"><p>Nenhum item cadastrado.</p></div>`;
                return;
            }
            
            container.innerHTML = state.items.map(item => {
                const restaurant = state.restaurants.find(r => r.id === item.restaurantId);
                return `
                <div class="card item-card">
                    <div class="restaurant-badge">${restaurant ? restaurant.name : 'Restaurante não encontrado'}</div>
                    <h3 class="card-title">${item.name}</h3>
                    <div class="card-subtitle">${item.type === 'almoco' ? 'Almoço' : item.type === 'lanche' ? 'Lanche' : 'Outros'}</div>
                    <p class="card-text">${item.description}</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                        <div style="font-weight: bold; color: var(--primary);">R$ ${item.price.toFixed(2)}</div>
                        <button class="item-select-btn" onclick="deleteItem(${item.id})" style="background-color: transparent; border-color: var(--danger); color: var(--danger);">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </div>
                </div>
            `}).join('');
        }
        
        window.deleteItem = function(itemId) {
            if (confirm('Tem certeza que deseja excluir este item?')) {
                const itemIndex = state.items.findIndex(i => i.id === itemId);
                
                if (itemIndex >= 0) {
                    state.items.splice(itemIndex, 1);
                    
                    const localIndex = state.localData.items.findIndex(i => i.id === itemId);
                    if (localIndex >= 0) {
                        state.localData.items.splice(localIndex, 1);
                    }
                    
                    saveLocalData();
                    loadAdminItems();
                    loadRestaurantFilters();
                    loadItemsByFilters();
                    showAlert('Item excluído com sucesso!', 'success');
                }
            }
        }
        
        function loadRestaurantsTable() {
            const tbody = document.getElementById('restaurantsTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = state.restaurants.map(restaurant => {
                const itemCount = state.items.filter(item => item.restaurantId === restaurant.id).length;
                return `
                <tr>
                    <td>${restaurant.name}</td>
                    <td>${restaurant.address}</td>
                    <td>${itemCount} item(s)</td>
                    <td>
                        <button class="item-select-btn" onclick="deleteRestaurant(${restaurant.id})" style="background-color: transparent; border-color: var(--danger); color: var(--danger); padding: 5px 10px; font-size: 0.9rem;">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </td>
                </tr>
            `}).join('');
        }
        
        window.deleteRestaurant = async function(restaurantId) {
            const itemCount = state.items.filter(item => item.restaurantId === restaurantId).length;
            
            if (itemCount > 0) {
                showAlert('Não é possível excluir um restaurante que possui itens cadastrados!', 'error');
                return;
            }
            
            if (confirm('Tem certeza que deseja excluir este restaurante?')) {
                const restaurantIndex = state.restaurants.findIndex(r => r.id === restaurantId);
                
                if (restaurantIndex >= 0) {
                    if (state.isOnline && state.currentUser && state.currentUser.level === 'admin') {
                        try {
                            await deleteFromBaserow(BASEROW_CONFIG.TABLES.RESTAURANTS.id, restaurantId);
                            showAlert('Restaurante excluído do servidor!', 'success');
                        } catch (error) {
                            console.error('Erro ao excluir restaurante:', error);
                            showAlert('Erro ao excluir do servidor. Excluindo localmente.', 'error');
                        }
                    }
                    
                    state.restaurants.splice(restaurantIndex, 1);
                    updateRestaurantSelect();
                    loadRestaurantFilters();
                    loadRestaurantsTable();
                    showAlert('Restaurante excluído com sucesso!', 'success');
                }
            }
        }
        
        function loadUsersTable() {
            const tbody = document.getElementById('usersTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = state.users.map(user => `
                <tr>
                    <td>${user.name}</td>
                    <td>${user.login}</td>
                    <td><span class="badge ${user.level === 'admin' ? 'badge-admin' : 'badge-operator'}">
                        ${user.level === 'admin' ? 'Administrador' : 'Operador'}
                    </span></td>
                    <td>
                        <div style="display: flex; gap: 5px;">
                            <button class="item-select-btn" onclick="openEditUserModal(${user.id})" style="background-color: transparent; border-color: var(--primary); color: var(--primary); padding: 5px 10px; font-size: 0.9rem;">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            ${user.id > 2 ? `
                                <button class="item-select-btn" onclick="deleteUser(${user.id})" style="background-color: transparent; border-color: var(--danger); color: var(--danger); padding: 5px 10px; font-size: 0.9rem;">
                                    <i class="fas fa-trash"></i> Excluir
                                </button>
                            ` : ''}
                        </div>
                    </td>
                </tr>
            `).join('');
        }
        
        window.openEditUserModal = function(userId) {
            const user = state.users.find(u => u.id === userId);
            if (!user) return;
            
            document.getElementById('editUserId').value = user.id;
            document.getElementById('editUserName').value = user.name;
            document.getElementById('editUserLogin').value = user.login;
            document.getElementById('editUserPassword').value = '';
            document.getElementById('editUserLevel').value = user.level;
            
            document.getElementById('editUserModal').classList.remove('hidden');
        }
        
        window.closeEditUserModal = function() {
            document.getElementById('editUserModal').classList.add('hidden');
            document.getElementById('editUserForm').reset();
        }
        
        window.deleteUser = async function(userId) {
            if (userId <= 2) {
                showAlert('Usuários padrão não podem ser excluídos!', 'error');
                return;
            }
            
            if (confirm('Tem certeza que deseja excluir este usuário?')) {
                const userIndex = state.users.findIndex(u => u.id === userId);
                
                if (userIndex >= 0) {
                    if (state.isOnline && state.currentUser && state.currentUser.level === 'admin') {
                        try {
                            await deleteFromBaserow(BASEROW_CONFIG.TABLES.USERS.id, userId);
                            showAlert('Usuário excluído do servidor!', 'success');
                        } catch (error) {
                            console.error('Erro ao excluir usuário:', error);
                            showAlert('Erro ao excluir do servidor. Excluindo localmente.', 'error');
                        }
                    }
                    
                    state.users.splice(userIndex, 1);
                    loadUsersTable();
                    showAlert('Usuário excluído com sucesso!', 'success');
                }
            }
        }
        
        function showAlert(message, type) {
            const existingAlert = document.querySelector('.alert');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            
            const contentArea = document.querySelector('.content-area');
            if (contentArea) {
                contentArea.insertBefore(alert, contentArea.firstChild);
                
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.remove();
                    }
                }, 5000);
            }
        }
        
        // Inicializar status
        updateConnectionStatus();
    </script>
</body>
</html>


